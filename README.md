# Описание проекта для IT-ONE

## Быстрый старт

* **Для начала необходимо сгенерировать SSL-сертификаты и ключи, выполнив следующую команду:**

```sh
./key_generation.sh
```

* **После этого вам останется только запустить *'docker-compose up'*:**

```sh
docker-compose up
```

### Документация к API

#### [Documentation](/server/README.md)

## Краткая информация

### Защищенное соединение

В проекте мы придаем особое внимание безопасности передачи данных, используя SSL-шифрование для всех обращений к базе данных, NATS.io и внешним сервисам. Это позволяет обеспечить конфиденциальность и целостность информации, передаваемой между различными компонентами системы.

Кроме того, NATS.io может также выступать в роли "посредника" между сервисами, обеспечивая защищенное соединение между ними. Это означает, что даже если сеть подвергнется атаке или перехвату данных, информация будет защищена благодаря использованию SSL-шифрования на уровне NATS.io.

### Внешние сервисы

Для эмуляции внешного сервиса (API Банка) мы используем **roapi**. **roapi** предоставляет нам внешнюю REST-API, которое завязано на данных из Google.

### Средства мониторинга

Для мониторинга работы нашего приложения мы использовали *Prometheus* + *Grafana*, которые разворачиваются вместе с приложением.

Мониторинг находится на следующих адресах:

#### Prometheus

* <http://localhost:7080/>
* <http://localhost:9090/>

#### Grafana

Логин и пароль: *admin*

* <http://localhost:3000/>

## Тестирование

Мы реализовали 2 типа тестов:

* JUnit:
  * Юнит тесты для сущностей и компонентов бизнес логики
  * Покрытие кода тестами: *NN%*
* Grafana k6:
  * Нагрузочное тестирование базовое и продвинутое

### Отчёт по нагрузочному тестированию (Advanced)

#### Общая информация

* Инструменты тестирования: K6
* Сценарий тестирования: Автоматизированный скрипт advanced-load.js
* Всего проверок: 3683
* Продолжительность тестирования: 2 минуты и 30 секунд
* Максимальное количество виртуальных пользователей (VUs): 50
* Максимальная длительность теста: 2 минуты

#### Результаты тестирования

* Пройденные проверки: 100% (3683 из 3683)
* Ошибки: 0
* Среднее время выполнения запроса: 87.42 миллисекунд
* Объем полученных данных: 1.9 МБ
* Объем отправленных данных: 1.3 МБ
* Максимальное количество одновременно запущенных VUs: 50
* Максимальное количество запросов в секунду: 24.55

#### Анализ результатов

Нагрузочное тестирование показало, что наше приложение успешно справляется с нагрузкой в условиях максимальной нагрузки до 50 одновременных пользователей. Все проверки были успешно пройдены, а среднее время выполнения запроса составило 87.42 миллисекунды, что находится в пределах приемлемого времени ответа для пользователей.

#### Заключение

Нагрузочное тестирование позволило убедиться в том, что наше приложение готово к высокой нагрузке и способно обеспечить стабильную работу даже при максимальной нагрузке до 50 одновременных пользователей. Тем не менее, регулярное тестирование и мониторинг необходимы для поддержания высокого уровня производительности и надежности приложения.

[Результаты тестирования (Advanced)](/k6/advanced-out.md)

[Результаты тестирования (Basic)](/k6/basic-out.md)

## Конфигурация NATS.io

Command to add local message: `nats context add localhost --description "Localhost"`

Command to listen for changes in message queue: `nats sub db_sync`

## Интеграция со сторонними банками

Для эмуляции сторонних сервисов был использован `roapi`.
Формат данных:
| transaction_id | bank_name | account_number | transaction_date | amount | currency | transaction_type |
|----------------|-----------|----------------|------------------|--------|----------|------------------|
| INVN8FNSO | Global Bank | 923139644042 | 2023-10-31 20:29:43 | 295.21 | INR | deposit |

## Получение данных с localhost:8080 (развертывание в докере)

## Примеры запросов

* Using SQL

```bash
curl -X POST -d "SELECT transaction_id, bank_name, account_number, transaction_date, amount, currency, transaction_type FROM transactions LIMIT 2" localhost:8080/api/sql
```

* Using GraphQL

```bash
curl -X POST -d "query { transactions(limit: 2) {transaction_id, bank_name, account_number, transaction_date, amount, currency, transaction_type} }" localhost:8080/api/graphql
```

* Using REST API

```bash
curl "localhost:8080/api/tables/transactions?columns=transaction_id,bank_name,account_number,transaction_date,amount,currency,transaction_type&limit=2"
```
