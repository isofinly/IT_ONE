# Описание проекта для IT-ONE

## Быстрый старт

* **Для начала необходимо сгенерировать SSL-сертификаты и ключи, выполнив следующую команду:**

```sh
./key_generation.sh
```

* **После этого вам останется только запустить *'docker-compose up'*:**

```sh
docker-compose up
```

### Документация к API

#### [Documentation](/server/README.md)

## Краткая информация

### Защищенное соединение

В проекте мы придаем особое внимание безопасности передачи данных, используя SSL-шифрование для всех обращений к базе данных, NATS.io и внешним сервисам. Это позволяет обеспечить конфиденциальность и целостность информации, передаваемой между различными компонентами системы.

Кроме того, NATS.io может также выступать в роли "посредника" между сервисами, обеспечивая защищенное соединение между ними. Это означает, что даже если сеть подвергнется атаке или перехвату данных, информация будет защищена благодаря использованию SSL-шифрования на уровне NATS.io.

### Внешние сервисы

Для эмуляции внешного сервиса (API Банка) мы используем **roapi**. **roapi** предоставляет нам внешнюю REST-API, которое завязано на данных из Google.

### Средства мониторинга

Для мониторинга работы нашего приложения мы использовали *Prometheus* + *Grafana*, которые разворачиваются вместе с приложением.

Мониторинг находится на следующих адресах:

#### Prometheus

* <http://localhost:7080/>
* <http://localhost:9090/>

#### Grafana

Логин и пароль: *admin*

* <http://localhost:3000/>

## Тестирование

Мы реализовали 2 типа тестов:

* JUnit:
  * Юнит тесты для сущностей и компонентов бизнес логики
* Grafana k6:
  * Нагрузочное тестирование базовое и продвинутое

### Отчёт по нагрузочному тестированию (Advanced)

#### Сценарий нагрузочного теста

* 1 сценарий
* Максимум 50 одновременных виртуальных пользователей (VUs)  
* Общая продолжительность 2 минуты 30 секунд, включая плавный завершающий этап

#### Метрики

* Проверки: 100% успешных (3683 из 3683)
* Ошибки: 0%  
* Данные получено: 1.9 МБ (13 кБ/с)
* Данные отправлено: 1.3 МБ (8.6 кБ/с)

#### Время отклика HTTP

* Среднее: 87.42 мс
* Медиана: 42.27 мс
* 90-й перцентиль: 241.77 мс
* 95-й перцентиль: 246.12 мс
* Минимум: 135.51 мкс
* Максимум: 496.57 мс  

#### Задержки времени отклика

* Блокировка: средн. 3.19 мкс, макс. 193.38 мкс  
* Подключение: средн. 792 нс, макс. 73.95 мкс
* Получение данных: средн. 25.94 мкс, макс. 192.93 мкс
* Отправка данных: средн. 10.09 мкс, макс. 196.93 мкс
* Ожидание: средн. 87.39 мс, макс. 496.54 мс

#### Скорость запросов

* 24.55 запросов в секунду

#### Итерации

* 0 завершенных
* 50 прерванных после 2 минут

#### Загрузка VUs

* 50 максимальное количество
* Средняя загрузка 50 VUs

#### Основные выводы

* Никаких ошибок не было обнаружено
* Медианное время отклика 42 мс является приемлемым
* 90-й и 95-й перцентили времени отклика относительно высоки (241 мс и 246 мс соответственно)
* Максимальное время отклика 496 мс может быть неприемлемым для некоторых критических операций
* Скорость запросов 24.55 в секунду возможно низковата для высоконагруженной системы

[Результаты тестирования (Advanced)](/k6/advanced-out.md)

[Результаты тестирования (Basic)](/k6/basic-out.md)

## Конфигурация NATS.io

Command to add local message: `nats context add localhost --description "Localhost"`

Command to listen for changes in message queue: `nats sub db_sync`

## Интеграция со сторонними банками

Для эмуляции сторонних сервисов был использован `roapi`.
Формат данных:
| transaction_id | bank_name | account_number | transaction_date | amount | currency | transaction_type |
|----------------|-----------|----------------|------------------|--------|----------|------------------|
| INVN8FNSO | Global Bank | 923139644042 | 2023-10-31 20:29:43 | 295.21 | INR | deposit |

## Получение данных с localhost:8080 (развертывание в докере)

## Примеры запросов

* Using SQL

```bash
curl -X POST -d "SELECT transaction_id, bank_name, account_number, transaction_date, amount, currency, transaction_type FROM transactions LIMIT 2" localhost:8080/api/sql
```

* Using GraphQL

```bash
curl -X POST -d "query { transactions(limit: 2) {transaction_id, bank_name, account_number, transaction_date, amount, currency, transaction_type} }" localhost:8080/api/graphql
```

* Using REST API

```bash
curl "localhost:8080/api/tables/transactions?columns=transaction_id,bank_name,account_number,transaction_date,amount,currency,transaction_type&limit=2"
```
